// МОДУЛЬ ФОРМЫ ДОКУМЕНТА "ЗАКАЗНАРЯД"

&НаКлиенте
Процедура ПриОткрытии(Отказ)
    // Инициализация формы
КонецПроцедуры

// ===== КНОПКА ДЛЯ АВТОМАТИЧЕСКОЙ ПОДСТАНОВКИ ЦЕН =====

&НаКлиенте
Процедура ПодставитьВсеЦены(Команда)
    
    // 1. Обрабатываем услуги
    Для Каждого СтрокаУслуги Из Объект.Услуги Цикл
        Если СтрокаУслуги.Номенклатура <> Неопределено Тогда
            // Если цена пустая или 0
            Если СтрокаУслуги.Цена = 0 Или СтрокаУслуги.Цена = Неопределено Тогда
                СтрокаУслуги.Цена = 100; // Фиксированная цена для услуг
            КонецЕсли;
            // Пересчет суммы
            СтрокаУслуги.Сумма = СтрокаУслуги.Количество * СтрокаУслуги.Цена;
        КонецЕсли;
    КонецЦикла;
    
    // 2. Обрабатываем материалы
    Для Каждого СтрокаМатериала Из Объект.Материалы Цикл
        Если СтрокаМатериала.Материал <> Неопределено Тогда
            // Если цена пустая или 0
            Если СтрокаМатериала.Цена = 0 Или СтрокаМатериала.Цена = Неопределено Тогда
                СтрокаМатериала.Цена = 50; // Фиксированная цена для материалов
            КонецЕсли;
            // Пересчет суммы
            СтрокаМатериала.Сумма = СтрокаМатериала.Количество * СтрокаМатериала.Цена;
        КонецЕсли;
    КонецЦикла;
    
    Сообщить("Цены и суммы успешно подставлены!");
    
КонецПроцедуры

// ===== ПРОСТЫЕ ОБРАБОТЧИКИ ДЛЯ АВТОМАТИЧЕСКОГО РАСЧЕТА =====

&НаКлиенте
Процедура ПересчитатьСуммуУслуги()
    // Пересчитываем сумму для текущей строки услуг
    ТекСтрока = Объект.Услуги.ТекущаяСтрока();
    Если ТекСтрока <> Неопределено Тогда
        ТекСтрока.Сумма = ТекСтрока.Количество * ТекСтрока.Цена;
    КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПересчитатьСуммуМатериала()
    // Пересчитываем сумму для текущей строки материалов
    ТекСтрока = Объект.Материалы.ТекущаяСтрока();
    Если ТекСтрока <> Неопределено Тогда
        ТекСтрока.Сумма = ТекСтрока.Количество * ТекСтрока.Цена;
    КонецЕсли;
КонецПроцедуры